<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>readme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="README_files/libs/clipboard/clipboard.min.js"></script>
<script src="README_files/libs/quarto-html/quarto.js"></script>
<script src="README_files/libs/quarto-html/popper.min.js"></script>
<script src="README_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="README_files/libs/quarto-html/anchor.min.js"></script>
<link href="README_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="README_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="README_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="README_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="README_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<p><img src="https://iccs.cam.ac.uk/sites/iccs.cam.ac.uk/files/logo2_1.png" width="355" align="left"></p>
<p><br><br><br><br><br></p>
<section id="iccs-scientific-visualisation" class="level1">
<h1>ICCS Scientific visualisation</h1>
<p><img src="https://img.shields.io/github/license/Cambridge-ICCS/summer-school-scientific-vis.png" class="img-fluid" alt="GitHub"> <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg" class="img-fluid" alt="CC BY-NC-SA 4.0"></a></p>
<p>This repository contains documentation, resources, and code for the Scientific Visualisation with matplotlib session designed and delivered by <a href="https://jackatkinson.net/">Jack Atkinson</a> (<a href="https://github.com/jatkinson1000"><strong><span class="citation" data-cites="jatkinson1000">@jatkinson1000</span></strong></a>) and James Emberton (<a href="https://github.com/j-emberton"><strong><span class="citation" data-cites="j-emberton">@j-emberton</span></strong></a>) of <a href="https://github.com/Cambridge-ICCS">ICCS</a>.<br>
The material has been delivered at the <a href="https://iccs.cam.ac.uk/events/iccs-summer-school-2024">ICCS</a> summer school.<br>
All materials, including slides and videos, are available such that individuals can cover the course in their own time.</p>
<section id="contents" class="level2">
<h2 class="anchored" data-anchor-id="contents">Contents</h2>
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#teaching-material">Teaching material</a></li>
<li><a href="#preparation-and-prerequisites">Preparation and prerequisites</a></li>
<li><a href="#installation-and-setup">Installation and setup</a></li>
<li><a href="#jose-publication">JOSE Publication</a></li>
<li><a href="#license">License information</a></li>
<li><a href="#contribution-guidelines-and-support">Contribution Guidelines and Support</a></li>
</ul>
</section>
</section>
<section id="learning-objectives" class="level1">
<h1>Learning Objectives</h1>
<p>The key learning objective from this workshop is to build skills in scientific visualisation through python and its libraries.</p>
<p>However, more specifically we aim to:</p>
<p>summarise key considerations when visualising scientific data, provide an understanding of the Matplotlib package and how to use it effectively, introduce the Cartopy package and show how it extends Matplotlib functionality for geospatial plotting, introduce common climate data formats and show how these can be parsed to generate plottable data, and encourage good research software engineering (RSE) practice while using code to generate scientific visualisations.</p>
</section>
<section id="teaching-material" class="level1">
<h1>Teaching material</h1>
<p>The course material is supplied as Quarto markdown slides with an accompanying jupyter lab notebook.</p>
<p>Slides can be found in the <a href="presentation/">presentation</a> directory.</p>
<p>Notebook can be found in the <a href="notebook/">notebook</a> directory.</p>
<section id="preparation-and-pre-requisites" class="level2">
<h2 class="anchored" data-anchor-id="preparation-and-pre-requisites">Preparation and pre-requisites</h2>
<p>To get the most out of the session we assume a basic understanding in a few areas and for you to do some preparation in advance. Expected knowledge is outlined below, along with resources for reading if you are unfamiliar.</p>
<section id="python" class="level3">
<h3 class="anchored" data-anchor-id="python">Python</h3>
<p>The course will be taught in python using netCDF4, Matplotlib and Cartopy. Whilst no prior knowledge of thes epython packages is expected we assume users are familiar with the basics of Python3. This includes: - Basic mathematical operations - Writing and running scripts/programs - Writing and using functions - The concept of <a href="https://eli5.gg/Object-oriented%20programming">object orientation</a><br>
i.e.&nbsp;that an object, e.g.&nbsp;a dataset, can have associated functions/methods associated with it. - Familiarity with the <a href="https://jupyter-notebook-beginner-guide.readthedocs.io/en/latest/index.html">concept of a jupyter notebook</a></p>
</section>
<section id="git-and-github" class="level3">
<h3 class="anchored" data-anchor-id="git-and-github">git and GitHub</h3>
<p>You will be expected to know how to - clone and/or fork a repository</p>
<p>The <a href="https://www.youtube.com/watch?v=ZrwzK4CnJ3Q">workshop from the 2022 ICCS Summer School</a> should provide the necessary knowledge.</p>
</section>
<section id="preparation" class="level3">
<h3 class="anchored" data-anchor-id="preparation">Preparation</h3>
<p>In preparation for the course please ensure that your computer contains the following: - A text editor - e.g.&nbsp;vim/<a href="https://neovim.io/">neovim</a>, <a href="https://gedit.en.softonic.com/">gedit</a>, <a href="https://code.visualstudio.com/">vscode</a>, <a href="https://www.sublimetext.com/">sublimetext</a> etc. to open and edit code files - A terminal emulator - e.g.&nbsp;<a href="https://help.gnome.org/users/gnome-terminal/stable/">GNOME Terminal</a>, <a href="https://wezfurlong.org/wezterm/index.html">wezterm</a>, <a href="https://learn.microsoft.com/en-us/windows/terminal/">Windows Terminal (windows only)</a>, <a href="https://iterm2.com/">iTerm (mac only)</a> - python virtual environment (see <a href="#installation-and-setup">Installation and setup</a>)</p>
<p>Note for Windows users: <em>We have linked suitable applications for windows in the above lists. However, you may wish to refer to <a href="https://learn.microsoft.com/en-us/windows/python/beginners">Windowsâ€™ getting-started with python information</a> for a complete guide to getting set up on a Windows system.</em></p>
<p>If you require assistance or further information with any of these please reach out to us before a training session.</p>
</section>
</section>
<section id="building" class="level2">
<h2 class="anchored" data-anchor-id="building">Building</h2>
<p>The slides are written using quarto. To build them run:</p>
<pre><code>quarto render Scientific_Vis.qmd </code></pre>
<p>from this directory and inspect the output .html file.</p>
</section>
<section id="installation-and-setup" class="level2">
<h2 class="anchored" data-anchor-id="installation-and-setup">Installation and setup</h2>
<p>There are three options for participating in this workshop for which instructions are provided below:</p>
<ul>
<li>via a <a href="#local-install">local install</a></li>
<li>on <a href="#google-colab">Google Colab</a></li>
<li>on <a href="#binder">binder</a></li>
</ul>
<p>We recommend the <a href="#local-install">local install</a> approach, especially if you forked the repository, as it is the easiest way to keep a copy of your work and push back to GitHub.</p>
<p>However, if you experience issues with the installation process or are unfamiliar with the terminal/installation process there is the option to run the notebooks in <a href="#google-colab">Google Colab</a> or on <a href="#binder">binder</a>.</p>
<section id="local-install" class="level3">
<h3 class="anchored" data-anchor-id="local-install">Local Install</h3>
<section id="clone-or-fork-the-repository" class="level4">
<h4 class="anchored" data-anchor-id="clone-or-fork-the-repository">1. Clone or fork the repository</h4>
<p>Navigate to the location you want to install this repository on your system and clone via https by running:</p>
<pre><code>git clone https://github.com/Cambridge-ICCS/summer-school-scientific-vis.git</code></pre>
<p>This will create a directory <code>summer-school-scientific-vis/</code> with the contents of this repository.</p>
<p>Please note that if you have a GitHub account and want to preserve any work you do we suggest you first <a href="https://github.com/Cambridge-ICCS/summer-school-scientific-vis/fork">fork the repository</a> and then clone your fork. This will allow you to push your changes and progress from the workshop back up to your fork for future reference.</p>
</section>
<section id="create-a-virtual-environment" class="level4">
<h4 class="anchored" data-anchor-id="create-a-virtual-environment">2. Create a virtual environment</h4>
<p>Before installing any Python packages it is important to first create a Python virtual environment. This provides an insulated environment inside which we can install Python packages without polluting the operating systemsâ€™ Python environment.</p>
<p>If you have never done this before donâ€™t worry: it is <em>very</em> good practise, especially when you are working on multiple projects, and easy to do.</p>
<pre><code>python3 -m venv SVvenv</code></pre>
<p>This will create a directory called <code>SVvenv</code> containing software for the virtual environment. To activate the environment run:</p>
<pre><code>source SVvenv/bin/activate</code></pre>
<p>You can now work on python from within this isolated environment, installing packages as you wish without disturbing your base system environment.</p>
<p>When you have finished working on this project run:</p>
<pre><code>deactivate</code></pre>
<p>to deactivate the venv and return to the system python environment.</p>
<p>You can always boot back into the venv as you left it by running the activate command again.</p>
</section>
<section id="install-dependencies" class="level4">
<h4 class="anchored" data-anchor-id="install-dependencies">3. Install dependencies</h4>
<p>It is now time to install the dependencies for our code, for example PyTorch. The project has been packaged with a <a href="pyproject.toml"><code>pyproject.toml</code></a> so can be installed in one go. From within the root directory in a active virtual environment run:</p>
<pre><code>pip install .</code></pre>
<p>This will download the relevant dependencies into the venv as well as setting up the datasets that we will be using in the course.<br>
</p>
</section>
<section id="run-the-notebook" class="level4">
<h4 class="anchored" data-anchor-id="run-the-notebook">4. Run the notebook</h4>
<p>From the current directory, launch the jupyter notebook server:</p>
<pre><code>jupyter notebook</code></pre>
<p>This command should then point you to the right location within your browser to use the notebook, typically <a href="http://localhost:8888/">http://localhost:8888/</a>.</p>
</section>
</section>
</section>
<section id="license" class="level2">
<h2 class="anchored" data-anchor-id="license">License</h2>
<p>The code materials in this project are licensed under the <a href="LICENSE">MIT License</a>.</p>
<p>The teaching materials are licensed under a <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" class="img-fluid figure-img" alt="CC BY-NC-SA 4.0"></a></p>
<figcaption>CC BY-NC-SA 4.0</figcaption>
</figure>
</div>
</section>
<section id="contribution-guidelines-and-support" class="level2">
<h2 class="anchored" data-anchor-id="contribution-guidelines-and-support">Contribution Guidelines and Support</h2>
<p>If you spot an issue with the materials please let us know by <a href="https://github.com/Cambridge-ICCS/summer-school-scientific-vis/issues/new/choose">opening an issue</a> here on GitHub clearly describing the problem.</p>
<p>If you are able to fix an issue that you spot, or an <a href="https://github.com/Cambridge-ICCS/summer-school-scientific-vis/issues">existing open issue</a> please get in touch by commenting on the issue thread.</p>
<p>Contributions from the community are welcome. To contribute back to the repository please first <a href="https://github.com/Cambridge-ICCS/summer-school-scientific-vis/fork">fork it</a>, make the neccessary changes to fix the problem, and then open a pull request back to this repository clerly describing the changes you have made. We will then preform a review and merge once ready.</p>
<p>If you would like support using these materials, adapting them to your needs, or delivering them please get in touch either via GitHub or via <a href="https://github.com/Cambridge-ICCS">ICCS</a>.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>